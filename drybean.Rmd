---
title: "Selecting Features in a Dry Bean Dataset"
subtitle: "Report for HarvardX PH125.9x: Data Science: Capstone"
author: "Samuel Bates"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: pdf_document
editor_options: 
  markdown: 
    wrap: 80
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
require(tidyverse)
require(readxl)
require(gridExtra)
require(kableExtra)
require(RColorBrewer)
require(ggridges)
require(scales)
options(digits = 5)

beans <- read_excel("DryBeanDataset/Dry_Bean_Dataset.xlsx")
beans <- beans %>% mutate(Class = factor(str_to_title(Class)))
colnames(beans) <- c("A", "P", "X", "x", "K", "Ec", "C", "Ed", "Ex", "S", "R",
                     "CO", "SF1", "SF2", "SF3", "SF4", "Class")
features <- setdiff(colnames(beans), "Class")
fig1caption <- "Distributions of the features."
```

# Introduction

For this report, I chose a dataset of measurements performed on seven types of
dry beans[@koklu2020].

Applied two techniques to reduce the dimensionality of the dataset.

Trained several models on four sets of features to see which could most
accurately predict the type of bean from the features.

# Data Exploration

The dataset contains 13,611 observations. Each observation was constructed from
a high-resolution photograph of a dry bean, and has 17 features. Twelve of the
features are geometric, four are unknown "shape factors" $SF1 - SF4$, and one
($Class$) indicates the type of bean. The twelve geometric factors are:

1.  Area (denoted by $A$): The number of pixels in the bean image.

2.  Perimeter ($P$): The length of the bean boundary measured in pixels.

3.  Major axis length ($X$[^1]): The length of the longest line that can be
    drawn within the bean boundary.

4.  Minor axis length ($x$): The length of the longest line perpendicular to the
    major axis that can be drawn within the bean boundary.

5.  Aspect ratio ($K$): Defined as $X / x$.

6.  Eccentricity ($Ec$): The eccentricity of an ellipse that has the same
    moments of inertia as the bean image.

7.  Convex area ($C$): The number of pixels within the smallest convext polygon
    that contains the bean image.

8.  Equivalent diameter ($Ed$): The diameter of a circle having the same area as
    the bean image. Expressed mathematically, $A = \pi {(Ed/2)}^2$, so $Ed$ is
    defined as $\sqrt{4 A / \pi}$.

9.  Extent ($Ex$): The ratio of the pixels in the bounding box to the bean area.

10. Solidity ($S$): Also known as convexity. The ratio of the pixels in the
    convex shell to the pixels in the bean image.

11. Roundness ($R$): Defined as $4 \pi A / P^2$.

12. Compactness ($CO$): Defined as $Ed / X$.

[^1]: The document accompanying the dataset uses $L$ and $l$ for the major and
    minor aix lengths. I changed it to X's since a lower-case L is not always
    distinguishable from an upper-case I.

There are seven types of bean represented: Barbunya, Bombay, Cali, Dermason,
Horoz, Seker, and Sira. Figure 1 shows the distribution of the features for each
type of bean.

```{r feature-ridgeplots, echo=FALSE, fig.height=7, fig.cap=`fig1caption`}
ridges <- geom_density_ridges(lwd = .2)
no_y <- theme(axis.text.y = element_blank(),
              axis.title.y = element_blank(),
              axis.ticks.y = element_blank())
no_legend <- theme(legend.position = "none")
colrs <- scale_fill_manual(values = brewer.pal(7, "Set1"))
x_text <- theme(axis.text.x = element_text(size = 8),
                axis.title.x = element_text(family = "Times", size = 9))

p01 <- beans %>% ggplot(aes(A, y = fct_rev(Class), fill = Class)) +
  theme_minimal() + ridges + xlab("Area (A)") + 
  labs(fill = "Type of bean") + no_y + x_text + colrs +
  theme(legend.text = element_text(family = "Times"),
        legend.title = element_text(family = "Times")) +
  scale_x_continuous(labels = comma)

p07 <- beans %>% ggplot(aes(C, y = fct_rev(Class), fill = Class)) +
  theme_minimal() + ridges + xlab("Convex area (C)") + 
  no_y + no_legend + x_text + colrs +
  scale_x_continuous(labels = comma)

feature_ridgeplot <- function(featname, featdesc) {
  featsym <- sym(featname)
  beans %>% ggplot(aes(!!featsym, y = fct_rev(Class), fill = Class)) +
    theme_minimal() + no_y + xlab(sprintf("%s (%s)", featdesc, featname)) +
    ridges + no_legend + x_text + colrs
}

p02 <- feature_ridgeplot("P", "Perimeter")
p03 <- feature_ridgeplot("X", "Major axis length")
p04 <- feature_ridgeplot("x", "Minor axis length")
p05 <- feature_ridgeplot("K", "Aspect Ratio")
p06 <- feature_ridgeplot("Ec", "Eccentricity")
p08 <- feature_ridgeplot("Ed", "Equiv. diameter")
p09 <- feature_ridgeplot("Ex", "Extent")
p10 <- feature_ridgeplot("S", "Solidity")
p11 <- feature_ridgeplot("R", "Roundness")
p12 <- feature_ridgeplot("CO", "Compactness")
p13 <- feature_ridgeplot("SF1", "Shape factor 1") +
  theme(axis.text.x = element_text(size = 6))
p14 <- feature_ridgeplot("SF2", "Shape factor 2")
p15 <- feature_ridgeplot("SF3", "Shape factor 3")
p16 <- feature_ridgeplot("SF4", "Shape factor 4")

areas <- arrangeGrob(p01, p07, 
                     top = "Features measuring an area",
                     ncol = 2, widths = c(.575, .425))
distances <- arrangeGrob(p02, p03, p04, p08, 
                         top = "Features measuring a distance",
                         ncol = 4)
ratios <- arrangeGrob(p05, p06, p09, p10, p11, p12, p13, p14, p15, p16,
                      top = "Remaining features",
                      ncol = 5, nrow = 2)
grid.arrange(areas, distances, ratios, nrow = 3, heights = c(10, 5, 8)/23)
```

## Reducing dimensions

Five of the geometric features are defined in terms of other features. Four of
these are explicit: aspect ratio, equivalent diameter, roundness, and
compactness. In addition, solidity $S$ is experimentally shown to be equal to
$A/C$. These relationships are verified to 9 decimal places by the following
code:

```{r math-relations echo=TRUE, message=TRUE}
near_zero <- 10^-10
all(
  max(abs(beans$K - beans$X / beans$x)) < near_zero,
  max(abs(beans$A - pi * beans$Ed^2 / 4)) < near_zero,
  max(abs(beans$S - beans$A / beans$C)) < near_zero,
  max(abs(beans$R - 4 * pi * beans$A / beans$P^2)) < near_zero,
  max(abs(beans$CO - beans$Ed / beans$X)) < near_zero)
```

Consequently, an observation is completely defined by just 11 features: the 7
remaining geometric features { $A$, $P$, $X$, $x$, $Ec$, $C$, $Ex$ }, plus the 4
shape factors { $SF1$, $SF2$, $SF3$, $SF4$ }.

Correlation allows us to eliminate another feature. Figure 1 shows that the area
$A$ and convex area $C$ distributions for each type of bean are very similar.
Table 1 shows that they are highly correlated, so $C$ can be safely removed from
the list of features. The table also provides evidence that we may safely remove
$CO$ and $Ed$, as $SF3$ and $P$, respectively, are highly correlated with them.

```{r correlations}
corr_table <- map_dfr(1:(length(features) - 1), function(i) {
  map_dfr((i+1):length(features), function(j) {
    tibble(f1 = features[i], f2 = features[j],
           corr = cor(beans %>% select(all_of(f1)),
                      beans %>% select(all_of(f2))))
  })
})
high_corrs <- corr_table %>% arrange(desc(abs(corr))) %>% filter(abs(corr) > .99)
knitr::kable(high_corrs, booktabs = T, digits = 5,
             col.names = c("Feature 1", "Feature 2", "Correlation"),
             caption = "The most highly-correlated features.") %>%
  kable_styling(latex_options = "hold_position")
```

We can also reduce the dimensionality of the data using principal components
analysis. Applying `prcomp` to the set of features, we discover that six
components can explain 100% of the variability.

```{r pca}
pca <- prcomp(beans %>% select(-Class))
knitr::kable(summary(pca)$importance[, 1:6], booktabs = T)
```

# Models and Analysis

x

# Results

x

# Conclusions

x

# Bibliography
